# ROS пакеты


Вся экосистема ROS основывается на концепции пакетов, которые включают различные компоненты. В этом топике мы знакомимся с возможностями создания пакетов, их редактирования, а также c инструментом сборки, который будет использоваться далее. Можно также подглядеть на [офф страницу =)](http://wiki.ros.org/ROS/Tutorials/CreatingPackage).

> Убедитесь, что ваша среда настроена, ваш ws инициализирован и виден в системе ROS. (см. предыдущий топик 0_01)

Для начала перейдем в наш ws, в директорию `src`:
```bash
cd ~/catkin_ws/src
```

Для создания пакета используется команда:
```bash
catkin_create_pkg [pkg_name] [dep1 dep2 ...]
```

В данной команде первым аргументом передается имя нового пакета, после перечисляются зависимости данного пакета.
Для начала создадим пакет и добавим поддержку библиотек python и cpp (c++):
```bash
catkin_create_pkg study_pkg rospy roscpp
```

Далее наблюдаем созданную папку `study_pkg` и два главных файла внутри: `CMakeLists.txt` и `package.xml`

##### > Создайте пакет `study_pkg` и просмотрите файлы `CMakeLists.txt` и `package.xml`

В содержании `package.xml` можно выделить основные блоки:  

Заголовок, в нем содержится основная инфа о пакете
```xml
<?xml version="1.0"?>
<package format="2">
  <name>study_pkg</name>
  <version>0.0.0</version>
  <description>The study_pkg package</description>
  <maintainer email="user@todo.todo">user</maintainer>
  <license>TODO</license>
```

Зависимости (инструмент сборки, сборка, экспорт, runtime (exec) - выполнение)
```xml
  <buildtool_depend>catkin</buildtool_depend>
  <build_depend>roscpp</build_depend>
  <build_depend>rospy</build_depend>
  <build_export_depend>roscpp</build_export_depend>
  <build_export_depend>rospy</build_export_depend>
  <exec_depend>roscpp</exec_depend>
  <exec_depend>rospy</exec_depend>
```

Остальное можно также наблюдать внутри комметариев формата xml. Там также приведены некоторые описания строк и блоков.

Внутри `CMakeLists.txt` можно также видеть много закомментированных блоков, но в основном можно вытащить базовые куски на момент инициализации:  

Определение минимальной версии сборки `cmake` и название проекта
```cmake
cmake_minimum_required(VERSION 2.8.3)
project(study_pkg)
```

Поиск и подключение зависимостей
```cmake
find_package(catkin REQUIRED COMPONENTS
  roscpp
  rospy
)
```

Также создаются базовые папки `include` (для заголовочных файлов) и `src` (для файлов исходных текстов).  

А теперь сделаем пакет видимым системе ROS - для этого надо просто вызвать сборку в рабочем пространстве. Перейдите в папку рабочего пространства:
```bash
cd ~/catkin_ws
```
и выполните команду сборки:
```bash
catkin_make
```

После успешного выполнения сборки убедимся в том, что экосистема ROS видит наш пакет:
```bash
rospack list
```

В списке должна быть строка
```
study_pkg /home/user/catkin_ws/src/study_pkg
```

С помощью команды `rospack help` можно получить информацию об утилите и ее аргументах.

> Вообще рекомендую не забывать этот аргумент `help` (или опцию `-h`), так как он применим ко всем утилитам ROS экосистемы. 

##### > Произведите сборку пакетов рабочего пространства и убедитесь в том, что новый пакет виден ROS


## Bash для ROS пакетов

Для работы с пакетами в консоли был разработан целый пакет - [rosbash](http://wiki.ros.org/rosbash). 
В него входят утилиты:
- roscd - перейти в пакет
```bash
roscd study_pkg
```
- rosls - отобразить список файлов пакета
```bash
rosls study_pkg
```
- rosed - изменить (открыть редактор) файл пакета
```bash
# Переменная EDITOR задает редактор, через который откроется файл
export EDITOR=nano
rosed study_pkg CMakeLists.txt
```
- roscp - копировать файл пакета
```bash
# Копировать `CMakeLists.txt` в домашнюю директорию
roscp study_pkg CMakeLists.txt ~/
```
- rosrun - запустить узел в пакете
```bash
rosrun rospy_tutorials talker
```
Утилиты `rospd` и `rosd` работают со стеком директорий. Их использование можно опустить до специальных приемов.

## В результате

- С помощью инструмента из набора `catkin` был создан первый пакет ROS и поверхностно рассмотрены файл системы сборки `cmake` - `CMakeLists.txt` и файл описания пакета `package.xml` в формате `XML`.
- Файл `CMakeLists.txt` будет далее основным файлом для редактирования и использования, так как именно он указывает необходимые зависимости и правила для сборки пакета; в свою очередь `package.xml` является скорее описанием пакета и требует пристального внимания при оформлении внешнего вида, что также очень важно.
- Полученный пакет будет использован в качестве основы для дальнейшего обучения, рассмотрения и тестов ROS.
- Познакомились с утилитами `rospack` и пакетом `rosbash`.
